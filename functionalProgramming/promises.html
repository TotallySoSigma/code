<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promises</title>
</head>

<body>
    <button type="button" onclick="run()">Run</button>
    <script>
        function run() {
            //checkAge(10);
            //ex2();
            //asyncAndAwait2();
            //ex3();
            //allEx1();
            //throwVsReject();
            sequentialAsyncTasks();
            //ex1();
            //asyncAndAwait();
            //chainPromises1(2);
            //helloAfter1Second();
        }
        function task1() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve("Task 1 completed")
                }, 1000);
            })
        }
        function task2() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve("Task 2 completed")
                }, 1000);
            })
        }
        function task3() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve("Task 3 completed")
                }, 1000);
            })
        }
        function ex1() {
            new Promise(function (resolve, reject) {
                if (Math.random() < 0.5) {
                    reject(`Ha Ha it failed`);
                }
                resolve(41);
            }).then(function (answer) {
                console.log(answer);
            }).catch(function (error) {
                console.error(error);
            }).finally(function () {
                console.info("Finally always runs");
            });
        }
        function allEx1() {
            Promise.all([
                fetch('https://jsonplaceholder.typicode.com/posts'),
                fetch('https://jsonplaceholder.typicode.com/users')
            ]).then(function (responses) {
                return Promise.all(responses.map(function (response) {
                    return response.json();
                }));
            }).then(function (data) {
                console.info(data);
            }).catch(function (error) {
                console.error(error);
            })
        }
        async function asyncAndAwait() {
            await fetch('https://jsonplaceholder.typicode.com/posts/')
                .then(function (response) {
                    return response.json();
                }).then(function (data) {
                    console.log("Async Fetch: " + data)
                });
            console.info('Async Message');
        }
        function asyncAndAwait2() {
            async function getAns() {
                return 42;
            }
            let answer = getAns();
            answer.then(function (data) {
                console.log(data);
            });
        }
        function helloAfter1Second() {
            new Promise((resolve, reject) => {
                setTimeout(() => console.log("Hello"), 1000);//^&
            });
        }
        function checkAge(age) {
            new Promise((resolve, reject) => {
                if (age > 18) {
                    resolve("Access granted");
                } else {
                    reject("Access denied");
                }
            }).then(function resolve(message) {
                console.log(message);
            }).catch(function reject(message) {
                console.error(message);
            });
        }
        function chainPromises1(num) {
            new Promise((resolve, reject) => {
            }).then(num *= 3).then(num += 4).then(console.log(num));
        }
        function ex2() {
            Promise.resolve(1)
                .then(x => {
                    console.log(x);
                    return x + 1;
                }).then(x => {
                    console.log(x);
                    return Promise.resolve(x + 1);
                }).then(x => {
                    console.log(x);
                });
        }
        function ex3() {
            Promise.resolve(10)
                .then(x => { x * 2 })
                .then(x => { console.log(x) });
        }
        function throwVsReject() {
            new Promise(function (resolve, reject) {
                if (!true) {
                    reject(`Ha Ha it failed`);
                }
                resolve(41);
            }).then(() => {
                throw "Error";
            })/* .then(() => {
                return Promise.reject("error");
            }); */;
        }
        function sequentialAsyncTasks() {
            console.log("Initiating Tasks");
            task1()
                .then(result1 => {
                    console.log(result1);
                    return task2();
                })
                .then(result2 => {
                    console.log(result2);
                    return task3();
                })
                .then(result3 => {
                    console.log(result3);
                }).finally(() => {
                    setTimeout(() => {
                        console.log("All Tasks Completed");
                    }, 1000);
                })
        }

    </script>
</body>

</html>